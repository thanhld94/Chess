<?php

function print_comment_form() {
echo <<<END
    <form action="$_SERVER[PHP_SELF]" method="post" id="commentform">
        Enter a name (First and last name)
        <input type="text" name="name" size="12" pattern="^[A-Za-z]+ [A-Za-z]+$" required="required"/>
        <br>
        <textarea name="comment" rows="5" cols="30" form="commentform" pattern="^[A-Za-z0-9 ?!]+$"></textarea>
        <br>
        <input type="hidden" name="stage" value="process">
        <input type="submit" value="Send">
        <input type="reset" value="Clear">
    </form>
    
END;
}

function send_new_comment() {
    $name = $_POST['name'];
    $comment = $_POST['comment'];
    $new_comment = "<p><strong>$name</strong>: $comment</p>";
    file_put_contents("comments.txt", $new_comment, FILE_APPEND);
}

function print_comments() {
    $lines = file("comments.txt");
    foreach( $lines as $line ) {
        print "$line";
    }
}

#main program

print "<h2>Comments:</h2>";

if (isset($_POST['stage']) && ('process' == $_POST['stage']))
    send_new_comment();
print_comments();
print_comment_form();

?>
